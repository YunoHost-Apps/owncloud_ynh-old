
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Shibboleth Integration (Enterprise Subscription only) &mdash; ownCloud Server Administration Manual 8.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '8.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <link rel="top" title="ownCloud Server Administration Manual 8.2 documentation" href="../index.html" />
    <link rel="up" title="User Management (ES only)" href="index.html" />
    <link rel="next" title="File Firewall" href="file_firewall_configuration.html" />
    <link rel="prev" title="User Management (ES only)" href="index.html" />
<script type="text/javascript">
(function () {
  /**
   * Patch TOC list.
   *
   * Will mutate the underlying span to have a correct ul for nav.
   *
   * @param $span: Span containing nested UL's to mutate.
   * @param minLevel: Starting level for nested lists. (1: global, 2: local).
   */
  var patchToc = function ($ul, minLevel) {
    var findA;

    // Find all a "internal" tags, traversing recursively.
    findA = function ($elem, level) {
      var level = level || 0,
        $items = $elem.find("> li > a.internal, > ul, > li > ul");

      // Iterate everything in order.
      $items.each(function (index, item) {
        var $item = $(item),
          tag = item.tagName.toLowerCase(),
          pad = 15 + ((level - minLevel) * 10);

        if (tag === 'a' && level >= minLevel) {
          // Add to existing padding.
          $item.css('padding-left', pad + "px");
          console.log(level, $item, 'padding-left', pad + "px");
        } else if (tag === 'ul') {
          // Recurse.
          findA($item, level + 1);
        }
      });
    };

    console.log("HERE");
    findA($ul);
  };

  $(document).ready(function () {
    // Add styling, structure to TOC's.
    $(".dropdown-menu").each(function () {
      $(this).find("ul").each(function (index, item){
        var $item = $(item);
        $item.addClass('unstyled');
      });
      $(this).find("li").each(function () {
        $(this).parent().append(this);
      });
    });

    // Patch in level.
    patchToc($("ul.globaltoc"), 2);
    patchToc($("ul.localtoc"), 2);

    // Enable dropdown.
    $('.dropdown-toggle').dropdown();
  });
}());
</script>

  </head>
  <body>
  

<div class="container">
  <div class="content">
    <div class="page-header">
      <h1><a href="../contents.html">ownCloud Server Administration Manual</a></h1>

    </div>
    
			<div class="row">
				<div class="span3">
					<div class="sidebar">
						<div class="well">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>
										
<li><a href="../contents.html">Table of Contents</a></li>
									</ul>
                  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">ownCloud 8.2 Server Administration Manual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">ownCloud 8.2 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new_admin.html">What&#8217;s New for Admins in ownCloud 8.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_user/index.html">User Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_files/index.html">File Sharing and Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_server/index.html">ownCloud Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_database/index.html">Database Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintenance/index.html">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operations/index.html">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Issues and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos/index.html">ownCloud Videos</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../enterprise_installation/index.html">Enterprise Subscription Installation (ES Only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_clients/index.html">Creating Branded ownCloud Clients (ES only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_external_storage/index.html">External Storage (ES only)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Management (ES only)</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Shibboleth Integration (Enterprise Subscription only)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#apache-configuration">Apache Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-configuration">Application Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-the-shibboleth-app">Enabling the Shibboleth App</a></li>
<li class="toctree-l3"><a class="reference internal" href="#webdav-support">WebDAV Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#known-limitations">Known Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encryption">Encryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-login-mechanisms">Other Login Mechanisms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#session-timeout">Session Timeout</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="file_firewall_configuration.html">File Firewall</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_files_drop/index.html">Enabling Anonymous Uploads with Files Drop (ES Only)</a></li>
</ul>

								</ul>
							</div>
						</div>
					</div>
				</div>
        

				<div class="span9">
					<div class="page-content">
						
  <div class="section" id="shibboleth-integration-enterprise-subscription-only">
<h1>Shibboleth Integration (Enterprise Subscription only)<a class="headerlink" href="#shibboleth-integration-enterprise-subscription-only" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The ownCloud Shibboleth user backend application integrates ownCloud with a
Shibboleth Service Provider (SP) and allows operations in federated and
single-sign-on infrastructures. Setting up Shibboleth has three steps:</p>
<ol class="arabic simple">
<li>Create the appropriate Apache configuration</li>
<li>Enable the Shibboleth app</li>
<li>Enable Shibboleth on your ownCloud admin page</li>
</ol>
<p>Currently supported installations are based on the <a class="reference external" href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPApacheConfig">native Apache integration</a>
. The individual configuration of the service provider is highly dependent on
the operating system, as well as on the integration with the Identity
Providers (IdP), and require case-by-case analysis and installation.</p>
<p>The ownCloud Desktop Client and mobile clients can interact with an
ownCloud instance running inside a Shibboleth Service Provider by using built-in
browser components for authentication against the IdP.</p>
<p>The ownCloud desktop sync client and mobile apps store users&#8217; logins, so
your users only need to enter their logins the first time they set up their
accounts. These screenshots show what the user sees at account setup. Figure 1
shows a test Shibboleth login screen from
<a class="reference external" href="https://www.testshib.org/index.html">Testshib.org</a> on the ownCloud desktop
sync client.</p>
<div class="figure">
<img alt="../_images/shib-gui1.png" src="../_images/shib-gui1.png" />
<p class="caption"><em>figure 1: First login screen</em></p>
</div>
<p>Then after going through the setup wizard, the desktop sync client displays the
server and login information just like it does for any other ownCloud server
connections.</p>
<div class="figure">
<img alt="../_images/shib-gui4.png" src="../_images/shib-gui4.png" />
<p class="caption"><em>figure 2: ownCloud client displays server information</em></p>
</div>
<p>To your users, it doesn&#8217;t look or behave differently on the desktop sync
client, Android app, or iOS app from an ordinary ownCloud account setup. The
only difference is the initial setup screen where they enter their account
login.</p>
</div>
<div class="section" id="apache-configuration">
<h2>Apache Configuration<a class="headerlink" href="#apache-configuration" title="Permalink to this headline">¶</a></h2>
<p>This is an example configuration as installed and operated on a Linux server
running the Apache Web server. These configurations are highly operating system
specific and require a high degree of customization.</p>
<p>The ownCloud instance itself is installed in <tt class="docutils literal"><span class="pre">/var/www/owncloud/</span></tt>.  The
following aliases are defined in an Apache virtual host directive:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="c"># non-Shibboleth access</span>
<span class="nb">Alias</span> <span class="sx">/owncloud</span> <span class="sx">/var/www/owncloud/</span>
<span class="c"># for Shibboleth access</span>
<span class="nb">Alias</span> <span class="sx">/oc-shib</span> <span class="sx">/var/www/owncloud/</span>
</pre></div>
</div>
<p>Further Shibboleth specific configuration as defined in
<tt class="docutils literal"><span class="pre">/etc/apache2/conf.d/shib.conf</span></tt>:</p>
<div class="highlight-apache"><pre>#
# Load the Shibboleth module.
#
LoadModule mod_shib /usr/lib64/shibboleth/mod_shib_22.so

#
# Ensures handler will be accessible.
#
&lt;Location /Shibboleth.sso&gt;
  Satisfy Any
  Allow from all
&lt;/Location&gt;

#
# Configure the module for content.
#
# Shibboleth is disabled for the following location to allow non
  shibboleth webdav access
&lt;Location ~ "/oc-shib/remote.php/nonshib-webdav"&gt;
  Satisfy Any
  Allow from all
  AuthType None
  Require all granted
&lt;/Location&gt;

# Shibboleth is disabled for the following location to allow public link
  sharing
&lt;Location ~
  "/oc-shib/(status.php$
  |public.php$
  |cron.php$
  |core/img/
  |index.php/apps/files_sharing/publicpreview.png$
  |index.php/apps/files/ajax/upload.php$
  |index.php/core/ajax/translations.php$
  |apps/files/templates/fileexists.html$
  |index.php/apps/files/ajax/mimeicon.php$)"&gt;
  Satisfy Any
  Allow from all
  AuthType None
  Require all granted
&lt;/Location&gt;

# Shibboleth is disabled for the following location to allow public gallery
  sharing
&lt;Location ~
 "/oc-shib/(apps/gallery/templates/slideshow.html$
 |index.php/apps/gallery/ajax/getimages.php
 |index.php/apps/gallery/ajax/thumbnail.php
 |index.php/apps/gallery/ajax/image.php)"&gt;
  Satisfy Any
  Allow from all
  AuthType None
  Require all granted
&lt;/Location&gt;

# Shibboleth is disabled for the following location to allow public link
  sharing
&lt;Location ~ "/oc-shib/.*\.css"&gt;
  Satisfy Any
  Allow from all
  AuthType None
  Require all granted
&lt;/Location&gt;

# Shibboleth is disabled for the following location to allow public link
  sharing
&lt;Location ~ "/oc-shib/.*\.js"&gt;
  Satisfy Any
  Allow from all
  AuthType None
  Require all granted
&lt;/Location&gt;

# Besides the exceptions above this location is now under control of
  Shibboleth
&lt;Location /oc-shib&gt;
  AuthType shibboleth
  ShibRequireSession On
  ShibUseHeaders Off
  ShibExportAssertion On
  require valid-user
&lt;/Location&gt;</pre>
</div>
</div>
<div class="section" id="application-configuration">
<h2>Application Configuration<a class="headerlink" href="#application-configuration" title="Permalink to this headline">¶</a></h2>
<p>After installing and enabling the Shibboleth application there are three
configuration variables to set up, depending on the data sent back by the
IdP. The configuration is stored in <tt class="docutils literal"><span class="pre">apps/user_shibboleth</span></tt>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">namespace OCA\user_shibboleth {</span>
<span class="x">        const SHIB_SESSION_ID = &#39;Shib-Session-ID&#39;;</span>
<span class="x">        const SHIB_EPPN = &#39;eppn&#39;;</span>
<span class="x">        const SHIB_EMAIL = &#39;eppn&#39;;</span>
<span class="x">        const SHIB_DISPLAY_NAME = &#39;eppn&#39;;</span>
<span class="x">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Parameter</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>SHIB_SESSION_ID</td>
<td>This constant defines the name of the environment
variable holding the Shibboleth session id.</td>
</tr>
<tr class="row-odd"><td>SHIB_EPPN</td>
<td>This constant defines the name of the environment
variable which holds the EPPN (eduPersonPrincipalName).
This is the unique user identifier.</td>
</tr>
<tr class="row-even"><td>SHIB_EMAIL</td>
<td>The environment variable with this given name holds the
email address of the logged-in user.</td>
</tr>
<tr class="row-odd"><td>SHIB_DISPLAY_NAME</td>
<td>This constant defines the name of the environment
variable holding the user&#8217;s display name.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="enabling-the-shibboleth-app">
<h2>Enabling the Shibboleth App<a class="headerlink" href="#enabling-the-shibboleth-app" title="Permalink to this headline">¶</a></h2>
<p>You must enable the Shibboleth app on your Apps page, and then check <strong>Activate
Shibboleth</strong> and click the <strong>Save</strong> button on your ownCloud Admin page. The
system information displayed on your Admin page may be useful for
troubleshooting; for example you can copy and include it on a support ticket.</p>
<div class="figure">
<img alt="../_images/shib-gui5.png" src="../_images/shib-gui5.png" />
<p class="caption"><em>figure 3: Enabling Shibboleth on the Admin page</em></p>
</div>
</div>
<div class="section" id="webdav-support">
<h2>WebDAV Support<a class="headerlink" href="#webdav-support" title="Permalink to this headline">¶</a></h2>
<p>Users of standard WebDAV clients can use an alternative
WebDAV Url, for example <tt class="docutils literal"><span class="pre">https://cloud.example.com/remote.php/nonshib-webdav/</span></tt>
to log in with their username and password. The password is generated on the
Personal settings page.</p>
<img alt="../_images/shibboleth-personal.png" src="../_images/shibboleth-personal.png" />
<p>For provisioning purpose an OCS API has been added to revoke a generated
password for a user:</p>
<p>Syntax: <tt class="docutils literal"><span class="pre">/v1/cloud/users/{userid}/non_shib_password</span></tt></p>
<ul class="simple">
<li>HTTP method: DELETE</li>
</ul>
<p>Status codes:</p>
<ul class="simple">
<li>100 - successful</li>
<li>998 - user unknown</li>
</ul>
</div>
<div class="section" id="known-limitations">
<h2>Known Limitations<a class="headerlink" href="#known-limitations" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="encryption">
<h2>Encryption<a class="headerlink" href="#encryption" title="Permalink to this headline">¶</a></h2>
<p>File encryption can not be used together with Shibboleth because the encryption
requires the user&#8217;s password to unlock the private encryption key. Due to the
nature of Shibboleth the user&#8217;s password is not known to the service provider.
Currently, we have no solution to this limitation.</p>
</div>
<div class="section" id="other-login-mechanisms">
<h2>Other Login Mechanisms<a class="headerlink" href="#other-login-mechanisms" title="Permalink to this headline">¶</a></h2>
<p>Shibboleth is not compatible with any other ownCloud user backend because the
login process is handled outside of ownCloud.</p>
<p>You can allow other login mechanisms (e.g. LDAP or ownCloud native) by creating
a second Apache virtual host configuration. This second location is not
protected by Shibboleth, and you can use your other ownCloud login mechanisms.</p>
</div>
<div class="section" id="session-timeout">
<h2>Session Timeout<a class="headerlink" href="#session-timeout" title="Permalink to this headline">¶</a></h2>
<p>Session timeout on Shibboleth is controlled by the IdP. It is not possible to
have a session length longer than the length controlled by the IdP. In extreme
cases this could result in re-login on mobile clients and desktop clients every
hour.</p>
<p>The session timeout can be overridden in the service provider, but this
requires a source code change of the Apache Shibboleth module. A patch can be
provided by the ownCloud support team.</p>
</div>
</div>


					</div>
				</div>
			</div>
    
  </div>
</div>
  </body>
</html>